# Домашнее задание к занятию «Конфигурация приложений»

### Цель задания

В тестовой среде Kubernetes необходимо создать конфигурацию и продемонстрировать работу приложения.

------

### Чеклист готовности к домашнему заданию

1. Установленное K8s-решение (например, MicroK8s).
2. Установленный локальный kubectl.
3. Редактор YAML-файлов с подключённым GitHub-репозиторием.

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Описание](https://kubernetes.io/docs/concepts/configuration/secret/) Secret.
2. [Описание](https://kubernetes.io/docs/concepts/configuration/configmap/) ConfigMap.
3. [Описание](https://github.com/wbitt/Network-MultiTool) Multitool.

------

### Задание 1. Создать Deployment приложения и решить возникшую проблему с помощью ConfigMap. Добавить веб-страницу

1. Создать Deployment приложения, состоящего из контейнеров nginx и multitool.
2. Решить возникшую проблему с помощью ConfigMap.
3. Продемонстрировать, что pod стартовал и оба конейнера работают.
   
   ```bash
   goddim@goddim:~$ kubectl describe pod myapp-pod-c9f788c66-6sfsc 
Name:             myapp-pod-c9f788c66-6sfsc
Namespace:        default
Priority:         0
Service Account:  default
Node:             goddim/10.0.2.15
Start Time:       Thu, 22 Aug 2024 15:08:18 +0800
Labels:           app=myapp
                  pod-template-hash=c9f788c66
Annotations:      cni.projectcalico.org/containerID: d05e9d6ae7487e289a7b32f4db0d913c0906533b368d718344debf64fb616dc2
                  cni.projectcalico.org/podIP: 10.1.100.73/32
                  cni.projectcalico.org/podIPs: 10.1.100.73/32
Status:           Running
IP:               10.1.100.73
IPs:
  IP:           10.1.100.73
Controlled By:  ReplicaSet/myapp-pod-c9f788c66
Init Containers:
  init-myservice:
    Container ID:  containerd://3aa649e44a0e18f9be30becf9b368acc0dfae5dc0a4323d52653b61502f3a678
    Image:         busybox:1.28
    Image ID:      docker.io/library/busybox@sha256:141c253bc4c3fd0a201d32dc1f493bcf3fff003b6df416dea4f41046e0f37d47
    Port:          <none>
    Host Port:     <none>
    Command:
      sh
      -c
      until nslookup myservice.$(cat /var/run/secrets/kubernetes.io/serviceaccount/namespace).svc.cluster.local; do echo waiting for myservice; sleep 2; done
    State:          Terminated
      Reason:       Completed
      Exit Code:    0
      Started:      Thu, 22 Aug 2024 15:14:41 +0800
      Finished:     Thu, 22 Aug 2024 15:14:41 +0800
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-tq9ks (ro)
Containers:
  network-multitool:
    Container ID:   containerd://c626c74d1a9822ba61f9e4b8ae2122e7e468f9c6c6b8f86a1351bae97461b4d3
    Image:          wbitt/network-multitool
    Image ID:       docker.io/wbitt/network-multitool@sha256:d1137e87af76ee15cd0b3d4c7e2fcd111ffbd510ccd0af076fc98dddfc50a735
    Port:           <none>
    Host Port:      <none>
    State:          Running
      Started:      Thu, 22 Aug 2024 15:14:56 +0800
    Ready:          True
    Restart Count:  0
    Limits:
      cpu:     200m
      memory:  512Mi
    Requests:
      cpu:        100m
      memory:     256Mi
    Environment:  <none>
    Mounts:
      /usr/share/nginx/html/ from nginx-index-file (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-tq9ks (ro)
Conditions:
  Type                        Status
  PodReadyToStartContainers   True 
  Initialized                 True 
  Ready                       True 
  ContainersReady             True 
  PodScheduled                True 
Volumes:
  nginx-index-file:
    Type:      ConfigMap (a volume populated by a ConfigMap)
    Name:      index-html-configmap
    Optional:  false
  kube-api-access-tq9ks:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   Burstable
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason   Age    From     Message
  ----    ------   ----   ----     -------
  Normal  Pulling  4m59s  kubelet  Pulling image "busybox:1.28"
  Normal  Pulled   4m49s  kubelet  Successfully pulled image "busybox:1.28" in 9.655s (9.655s including waiting). Image size: 727869 bytes.
  Normal  Created  4m49s  kubelet  Created container init-myservice
  Normal  Started  4m49s  kubelet  Started container init-myservice
  Normal  Pulling  4m49s  kubelet  Pulling image "wbitt/network-multitool"
  Normal  Pulled   4m34s  kubelet  Successfully pulled image "wbitt/network-multitool" in 14.537s (14.537s including waiting). Image size: 25281012 bytes.
  Normal  Created  4m34s  kubelet  Created container network-multitool
  Normal  Started  4m34s  kubelet  Started container network-multitool
```

5. Сделать простую веб-страницу и подключить её к Nginx с помощью ConfigMap. Подключить Service и показать вывод curl или в браузере.
   ![image](https://github.com/user-attachments/assets/5c4c6c2e-8bb4-4d0d-9abd-5675286d8ee9)
![image](https://github.com/user-attachments/assets/5e53e5cf-85ae-4d0b-8f00-3a224dcc186c)

6. Предоставить манифесты, а также скриншоты или вывод необходимых команд.

------

### Задание 2. Создать приложение с вашей веб-страницей, доступной по HTTPS 

1. Создать Deployment приложения, состоящего из Nginx.
2. Создать собственную веб-страницу и подключить её как ConfigMap к приложению.
3. Выпустить самоподписной сертификат SSL. Создать Secret для использования сертификата.
4. Создать Ingress и необходимый Service, подключить к нему SSL в вид. Продемонстировать доступ к приложению по HTTPS. 
4. Предоставить манифесты, а также скриншоты или вывод необходимых команд.

------

### Правила приёма работы

1. Домашняя работа оформляется в своём GitHub-репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд `kubectl`, а также скриншоты результатов.
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md.

------
