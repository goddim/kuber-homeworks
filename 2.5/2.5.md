# Домашнее задание к занятию «Helm»

### Цель задания

В тестовой среде Kubernetes необходимо установить и обновить приложения с помощью Helm.

------

### Чеклист готовности к домашнему заданию

1. Установленное k8s-решение, например, MicroK8S.
2. Установленный локальный kubectl.
3. Установленный локальный Helm.
4. Редактор YAML-файлов с подключенным репозиторием GitHub.

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Инструкция](https://helm.sh/docs/intro/install/) по установке Helm. [Helm completion](https://helm.sh/docs/helm/helm_completion/).

------

### Задание 1. Подготовить Helm-чарт для приложения
### Ответ
Скачиваем файлы для деплоя.
```
goddim@goddim:~/helm$ git clone https://github.com/aak74/kubernetes-for-beginners.git
Cloning into 'kubernetes-for-beginners'...
remote: Enumerating objects: 983, done.
remote: Counting objects: 100% (236/236), done.
remote: Compressing objects: 100% (173/173), done.
remote: Total 983 (delta 72), reused 173 (delta 45), pack-reused 747 (from 1)
Receiving objects: 100% (983/983), 2.64 MiB | 877.00 KiB/s, done.
Resolving deltas: 100% (362/362), done.
goddim@goddim:~/helm$ cp -R /root/helm/kubernetes-for-beginners/40-helm/ /root/helm/
cp: cannot stat '/root/helm/kubernetes-for-beginners/40-helm/': Permission denied
goddim@goddim:~/helm$ sudo cp -R /root/helm/kubernetes-for-beginners/40-helm/ /root/helm/
[sudo] password for goddim: 
cp: cannot stat '/root/helm/kubernetes-for-beginners/40-helm/': No such file or directory
goddim@goddim:~/helm$ cp /root/helm/kubernetes-for-beginners/40-helm/ /root/helm/
cp: cannot stat '/root/helm/kubernetes-for-beginners/40-helm/': Permission denied
goddim@goddim:~/helm$ sudo cp /root/helm/kubernetes-for-beginners/40-helm/ /root/helm/
[sudo] password for goddim: 
cp: cannot stat '/root/helm/kubernetes-for-beginners/40-helm/': No such file or directory
goddim@goddim:~/helm$ sudo cp /root/helm/kubernetes-for-beginners/40-helm/ /root/helm/
cp: cannot stat '/root/helm/kubernetes-for-beginners/40-helm/': No such file or directory
goddim@goddim:~/helm$ ls
kubernetes-for-beginners
goddim@goddim:~/helm$ cd kubernetes-for-beginners
goddim@goddim:~/helm/kubernetes-for-beginners$ ls
00-guidebooks  10-usage     15-install     20-concepts  40-helm     46-qbec  99-misc         images     volumes
01-components  11-commands  16-networking  30-kubectl   45-jsonnet  98-labs  authentication  README.md
goddim@goddim:~/helm/kubernetes-for-beginners$ cd\
> 
goddim@goddim:~$ sudo cp /goddim/helm/kubernetes-for-beginners/40-helm/ /root/helm/
cp: cannot stat '/goddim/helm/kubernetes-for-beginners/40-helm/': No such file or directory
goddim@goddim:~$ sudo cp /home/goddim/helm/kubernetes-for-beginners/40-helm/ /root/helm/
cp: -r not specified; omitting directory '/home/goddim/helm/kubernetes-for-beginners/40-helm/'
goddim@goddim:~$ sudo cp -R /home/goddim/helm/kubernetes-for-beginners/40-helm/ /root/helm/
goddim@goddim:~$ cd helm
goddim@goddim:~/helm$ rm -R kubernetes-for-beginners/
rm: remove write-protected regular file 'kubernetes-for-beginners/.git/objects/pack/pack-0abfb270ae960f04f412e99b53fae9e096afd173.idx'? y
rm: remove write-protected regular file 'kubernetes-for-beginners/.git/objects/pack/pack-0abfb270ae960f04f412e99b53fae9e096afd173.rev'? y
rm: remove write-protected regular file 'kubernetes-for-beginners/.git/objects/pack/pack-0abfb270ae960f04f412e99b53fae9e096afd173.pack'? y
goddim@goddim:~/helm$ ls
goddim@goddim:~/helm$
```
Создаем шаблон на базе данных файлов

```
goddim@goddim:~/helm$ sudo -i
cd /root/helm/40-helm/01-templating/charts/
root@goddim:~# cd /root/helm/40-helm/01-templating/charts/
root@goddim:~/helm/40-helm/01-templating/charts# helm template 01-simple
---
# Source: hard/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: demo
  labels:
    app: demo
spec:
  ports:
    - port: 80
      name: http
  selector:
    app: demo

# Source: hard/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: demo
  labels:
    app: demo
spec:
  replicas: 1
  selector:
    matchLabels:
      app: demo
  template:
    metadata:
      labels:
        app: demo
    spec:
      containers:
        - name: hard
          image: "nginx:1.16.0"
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          resources:
            limits:
              cpu: 200m
              memory: 256Mi
            requests:
              cpu: 100m
              memory: 128Mi
```
helm при запуске создаст service(port 80) и deployment(nginx version 1.16.0)

В переменных чарта меняем образ приложения
В файле Chart.yaml меняем номер версии приложения
```
root@goddim:~/helm/40-helm/01-templating/charts# nano 01-simple/Chart.yaml
root@goddim:~/helm/40-helm/01-templating/charts# cat  01-simple/Chart.yaml
apiVersion: v2
name: hard
description: A minimal chart for demo

type: application

version: 0.1.2
appVersion: "1.19.0"
root@goddim:~/helm/40-helm/01-templating/charts# 
```
смотрим шаблон

```
root@goddim:~/helm/40-helm/01-templating/charts# helm template 01-simple
# Source: hard/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: demo
  labels:
    app: demo
spec:
  ports:
    - port: 80
      name: http
  selector:
    app: demo

# Source: hard/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: demo
  labels:
    app: demo
spec:
  replicas: 1
  selector:
    matchLabels:
      app: demo
  template:
    metadata:
      labels:
        app: demo
    spec:
      containers:
        - name: hard
          image: "nginx:1.19.0"
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          resources:
            limits:
              cpu: 200m
              memory: 256Mi
            requests:
              cpu: 100m
              memory: 128Mi
```

### Задание 2. Запустить две версии в разных неймспейсах

1. Подготовив чарт, необходимо его проверить. Запуститe несколько копий приложения.
2. Одну версию в namespace=app1, вторую версию в том же неймспейсе, третью версию в namespace=app2.
3. Продемонстрируйте результат.

   ### ОТВЕТ
   проверяем
```


### Правила приёма работы

1. Домашняя работа оформляется в своём Git репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд `kubectl`, `helm`, а также скриншоты результатов.
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md.

